{"pageProps":{"post":{"slug":"kafka-schema-design","content":"\n```json\n{\n  \"type\": \"record\",\n  \"name\": \"ProductEvent\",\n  \"namespace\": \"com.example\",\n  \"fields\": [\n    {\n      \"name\": \"created\",\n      \"type\": [\n        \"null\",\n        {\n          \"type\": \"record\",\n          \"name\": \"Created\",\n          \"fields\": [\n            {\n              \"name\": \"id\",\n              \"type\": {\n                \"type\": \"string\",\n                \"logicalType\": \"uuid\"\n              }\n            },\n            {\n              \"name\": \"name\",\n              \"type\": \"string\"\n            }\n          ]\n        }\n      ],\n      \"default\": null\n    },\n    {\n      \"name\": \"deleted\",\n      \"type\": [\n        \"null\",\n        {\n          \"type\": \"record\",\n          \"name\": \"Deleted\",\n          \"fields\": [\n            {\n              \"name\": \"id\",\n              \"type\": {\n                \"type\": \"string\",\n                \"logicalType\": \"uuid\"\n              }\n            }\n          ]\n        }\n      ],\n      \"default\": null\n    }\n  ]\n}\n```\n\nJson representation\n\n```json\n{\n  \"created\": {\n    \"id\": \"8bb1f0b9-9767-4d36-8c3b-518c0ef77e96\",\n    \"name\": \"New Product\"\n  },\n  \"deleted\": null\n}\n```\n\n```kotlin\n@Component\nclass ProductListener(\n    private val productCreatedHandler: ProductCreatedHandler,\n    private val productDeletedHandler: ProductDeletedHandler,\n) {\n\n    @KafkaListener(topics = [\"product\"])\n    fun listen(record: ConsumerRecord<UUID, ProductEvent>) {\n        val productEvent = record.value()\n\n        productEvent.created?.also {\n            productCreatedHandler.handle(\n                NewProduct(\n                    ProductId(it.id),\n                    ProductName(it.name),\n                ),\n            )\n        }\n\n        productEvent.deleted?.also {\n            productDeletedHandler.handle(ProductId(record.key()))\n        }\n    }\n}\n```\n","title":"Kafka schema design","description":"How to write kafka schemas that allows for evolution","date":"Mar 3, 2023","draft":true}},"__N_SSG":true}