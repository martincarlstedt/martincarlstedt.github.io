<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/7326cdd8829f50d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7326cdd8829f50d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-b05cd08c4a1aceb2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f173ab93a2416500.js" defer=""></script><script src="/_next/static/chunks/750-cb383d7bbde68080.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-45676ace6e569333.js" defer=""></script><script src="/_next/static/qBSSL08vI8AZVhEaBf9YA/_buildManifest.js" defer=""></script><script src="/_next/static/qBSSL08vI8AZVhEaBf9YA/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__className_4b5723 text-gray-800"><div class="mx-auto px-4 py-10 max-w-7xl flex justify-between"><a href="/">Home</a></div><div class="mx-auto max-w-7xl px-4 py-8 mb-8 border-b border-slate-100"><div class="text-center text-3xl sm:text-4xl font-bold mb-4">Kafka schema design</div><div class="text-center mb-4 text-lg text-gray-500">How to write kafka schemas that allows for evolution</div></div><div class="mx-auto max-w-3xl px-4 prose prose-gray"><div><pre><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ProductEvent&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;namespace&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.example&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;created&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">&quot;null&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Created&quot;</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id&quot;</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">&quot;logicalType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uuid&quot;</span>
              <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;name&quot;</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deleted&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">&quot;null&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Deleted&quot;</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id&quot;</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">&quot;logicalType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uuid&quot;</span>
              <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</pre>
<p>Json representation</p>
<pre><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8bb1f0b9-9767-4d36-8c3b-518c0ef77e96&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;New Product&quot;</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
<span class="hljs-punctuation">}</span>
</pre>
<pre><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductListener</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> productCreatedHandler: ProductCreatedHandler,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> productDeletedHandler: ProductDeletedHandler,
) {

    <span class="hljs-meta">@KafkaListener(topics = [<span class="hljs-string">&quot;product&quot;</span>])</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">listen</span><span class="hljs-params">(record: <span class="hljs-type">ConsumerRecord</span>&lt;<span class="hljs-type">UUID</span>, ProductEvent&gt;)</span></span> {
        <span class="hljs-keyword">val</span> productEvent = record.value()

        productEvent.created?.also {
            productCreatedHandler.handle(
                NewProduct(
                    ProductId(it.id),
                    ProductName(it.name),
                ),
            )
        }

        productEvent.deleted?.also {
            productDeletedHandler.handle(ProductId(record.key()))
        }
    }
}
</pre>
</div></div><div class="py-8"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"kafka-schema-design","content":"\n```json\n{\n  \"type\": \"record\",\n  \"name\": \"ProductEvent\",\n  \"namespace\": \"com.example\",\n  \"fields\": [\n    {\n      \"name\": \"created\",\n      \"type\": [\n        \"null\",\n        {\n          \"type\": \"record\",\n          \"name\": \"Created\",\n          \"fields\": [\n            {\n              \"name\": \"id\",\n              \"type\": {\n                \"type\": \"string\",\n                \"logicalType\": \"uuid\"\n              }\n            },\n            {\n              \"name\": \"name\",\n              \"type\": \"string\"\n            }\n          ]\n        }\n      ],\n      \"default\": null\n    },\n    {\n      \"name\": \"deleted\",\n      \"type\": [\n        \"null\",\n        {\n          \"type\": \"record\",\n          \"name\": \"Deleted\",\n          \"fields\": [\n            {\n              \"name\": \"id\",\n              \"type\": {\n                \"type\": \"string\",\n                \"logicalType\": \"uuid\"\n              }\n            }\n          ]\n        }\n      ],\n      \"default\": null\n    }\n  ]\n}\n```\n\nJson representation\n\n```json\n{\n  \"created\": {\n    \"id\": \"8bb1f0b9-9767-4d36-8c3b-518c0ef77e96\",\n    \"name\": \"New Product\"\n  },\n  \"deleted\": null\n}\n```\n\n```kotlin\n@Component\nclass ProductListener(\n    private val productCreatedHandler: ProductCreatedHandler,\n    private val productDeletedHandler: ProductDeletedHandler,\n) {\n\n    @KafkaListener(topics = [\"product\"])\n    fun listen(record: ConsumerRecord\u003cUUID, ProductEvent\u003e) {\n        val productEvent = record.value()\n\n        productEvent.created?.also {\n            productCreatedHandler.handle(\n                NewProduct(\n                    ProductId(it.id),\n                    ProductName(it.name),\n                ),\n            )\n        }\n\n        productEvent.deleted?.also {\n            productDeletedHandler.handle(ProductId(record.key()))\n        }\n    }\n}\n```\n","title":"Kafka schema design","description":"How to write kafka schemas that allows for evolution","date":"Mar 3, 2023","draft":true}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"kafka-schema-design"},"buildId":"qBSSL08vI8AZVhEaBf9YA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>